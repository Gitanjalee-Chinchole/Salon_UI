<popup>
  <div id="purchase-items">
    <div class="" style="">
      <div>
        <form [formGroup]="itemForm">
          <div class="">
            <div class="row">
              <div class="col-md-3">
                <div class="form-group">
                  <label>Category</label>
                  <select style="" tabindex="-1" class="form-control input-sm" formControlName="parentCategory">
                    <option value="0">Please Select</option>
                    <option *ngFor="let item of parentCategory" class="" value="{{item.id}}">{{item.categorie}}
                    </option>
                  </select>
                </div>
              </div>
              <div class="col-md-3">
                <div class="form-group">
                  <label>Sub Category</label>
                  <select style="" tabindex="-1" formControlName="category" class="form-control input-sm">
                    <option value="">Please Select</option>
                    <option *ngFor="let cat of childCategory" class="" value="{{cat.id}}">{{cat.categorie}}
                    </option>
                  </select>

                </div>
              </div>
              <div class="col-md-3">
                <div class="form-group">
                  <label>Product Code</label>
                  <div class="input-group">
                    <div class="input-group-addon">
                      <i class="icon ion-ios-pricetags"></i>
                    </div>
                    <input type="text" placeholder="Product Code" class="form-control input-sm prevent-enter" formControlName="product_code">
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="form-group">
                  <label>Item/Product
                    <span style="color: red;">*</span>
                  </label>
                  <div class="input-group">
                    <div class="input-group-addon">
                      <i class="icon ion-bag"></i>
                    </div>
                    <input ngui-auto-complete [(ngModel)]="searchbox" [ngModelOptions]="{standalone:true}" [source]="searchItem.bind(this)" #searchValue
                      [list-formatter]="autoCompleteList" (valueChanged)="selectedItems($event)" close-on-focus='false' match-formatted='true'
                      value-property-name="id" display-property-name="itemName" placeholder="Search Item" class="form-control input-sm"
                      name="itemName">
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-3">
                <div class="form-group">
                  <label>Quantity
                    <span style="color: red;">*</span>
                  </label>
                  <div class="input-group">
                    <div class="input-group-addon">
                      <i class="icon ion-bag"></i>
                    </div>
                    <input type="text" name="quantity" maxlength="8" placeholder="Quantity" class="form-control  input-sm validate-decimal" formControlName="quantity"
                      (change)="getTotalAmount()">
                  </div>
                  <show-errors [control]="itemForm.controls.quantity"></show-errors>
                </div>
              </div>
              <div class="col-md-3">
                <div class="form-group">
                  <label>Unit
                    <span style="color: red;">*</span>
                  </label>
                  <div class="input-group">
                    <div class="input-group-addon">
                      <i class="fa fa-money"></i>
                    </div>
                    <select id="" style="" tabindex="-1" formControlName="unitId" class="form-control input-sm" aria-hidden="true">
                      <option value="">Please Select</option>
                      <option *ngFor="let item of units" class="" value="{{ item.id }}">{{ item.unit }}</option>
                    </select>

                  </div>
                </div>
              </div>

              <div class="col-md-3">
                <div class="form-group">
                  <label>MRP
                    <span style="color: red;">*</span>
                  </label>
                  <div class="input-group">
                    <div class="input-group-addon">
                      <i class="fa fa-money"></i>
                    </div>
                    <input type="text" name="MRP" placeholder="MRP." maxlength="6" required="required" class="form-control input-sm validate-decimal"
                      formControlName="mrp">
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="form-group">
                  <label>Rate
                    <span style="color: red;">*</span>
                  </label>
                  <div class="input-group">
                    <div class="input-group-addon">
                      <i class="fa fa-money"></i>
                    </div>
                    <input type="text" name="rate" placeholder="Rate." maxlength="6" class="form-control input-sm validate-decimal" formControlName="rate"
                      (change)="getTotalAmount()">
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="form-group">
                  <label>C.P. VAT(%)
                    <span style="color: red;">*</span>
                  </label>
                  <div class="input-group">
                    <div class="input-group-addon">
                      <i class="icon ion-bag"></i>
                    </div>
                    <input type="text" name="cp_vat" maxlength="8" placeholder="C.P. VAT" required="required" class="form-control  input-sm validate-decimal"
                      formControlName="cp_vat">
                  </div>
                  <show-errors [control]="itemForm.controls.cp_vat"></show-errors>
                </div>
              </div>
              <div class="col-md-3">
                <div class="form-group">
                  <label for="">Discount Rate(%)</label>
                  <input type="text" name="discount_rate" placeholder=" Discount Rate" maxlength="6" class="form-control input-sm validate-decimal"
                    formControlName="discount_rate" (change)="getTotalAmount()">
                </div>
              </div>
              <div class="col-md-3 ">
                <div class="form-group">
                  <label for="">Total Discount</label> :
                  <input type="text" readonly="readonly" (change)="getAmountCalculated()" class="input-sm form-control" formControlName="total_discount">
                </div>
              </div>
              <div class="col-md-3 pull-right">
                <div class="form-group well">
                  <label>Total Amount</label>:
                  <span style="font-weight: 700;">{{ itemForm.get('total_amount').value }}</span>
                </div>
              </div>
            </div>
          </div>
          <div id="itemFormDiv" class="modal-footer">
            <button class="btn btn-primary pull-left" (click)="addArrayList()">
              <i class="fa fa-floppy-o"></i> Add </button>
            <!---->
            <a class="btn btn-cyan pull-left" (click)="resetItemForm()">
              <i class="fa fa-refresh"></i> Reset</a>
            <button type="button" (click)="Show()" class="btn btn-default">Close</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</popup>
<div class="content-wrapper">
  <div>
    <toaster-container [toasterconfig]="config1"></toaster-container>
  </div>
  <!-- Content Header (Page header) -->
  <section class="content-header">
    <h1>
      Purchase Entry
      <small>Add/Edit Purchase Entry</small>
    </h1>
    <ol class="breadcrumb">
      <li>
        <a href="#">
          <i class="fa fa-dashboard"></i> Dashboard</a>
      </li>
      <li class="purchase/purchase_entrie">Purchase Entry</li>
    </ol>
  </section>

  <section class="content">


    <div id="purchase-module">
      <div class="row">
        <div class="col-md-6">
          <a class="btn bg-red new-purchase" (click)="show =!show">Add New</a>
        </div>
        <!-- <div class="col-md-6">
          <a href="http://192.168.1.177:90/sample/purchase_import.xlsx" download="" class="btn btn-primary  pull-right">
            <i aria-hidden="true" class="fa fa-download"></i>
            <strong> Sample Import Excel</strong>
          </a>
        </div> -->
      </div>
      <div class="row">
        <div id="purchaseFormDiv" class="purchaseFormDiv  margin-top-space " *ngIf="show" @slideIn>
          <form [formGroup]="form" (ngSubmit)="onSubmit()">
            <div class=" customer-box">
              <div class="col-md-12">
                <div class="box box-primary">
                  <div class="box-body">
                    <div class="row">
                      <div class="col-md-12">
                        <label>MRN No. :</label>
                        {{nextRecordId}}
                        <span></span>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-2">
                        <div class="form-group">
                          <label>MRN Date
                            <span style="color: red;">*</span>
                          </label>
                          <my-date-picker name="mrn_date" id="mrn_date" placeholder="MRN Date" formControlName="mrn_date" [options]="myDatePickerOptions"
                            [(ngModel)]="model" required></my-date-picker>
                          <show-errors [control]="form.controls.mrn_date"></show-errors>
                        </div>
                      </div>
                      <div class="col-md-3">
                        <div class="form-group">
                          <label>Supplier
                            <span style="color: red;">*</span>
                          </label>
                          <div class="input-group">
                            <div class="input-group-addon">
                              <i class="fa fa-user"></i>
                            </div>
                            <select name="supplier" tabindex="-1" class="form-control input-sm " formControlName="supplierId">
                              <option value="">Please Select</option>
                              <option value="{{supplier.id}}" *ngFor="let supplier of suppliers">{{supplier.company_name}}</option>
                            </select>
                          </div>
                          <show-errors [control]="form.controls.supplierId"></show-errors>
                        </div>
                      </div>
                      <div class="col-md-2">
                        <div class="form-group">
                          <label>Purchase Order No.</label>
                          <div class="input-group">
                            <div class="input-group-addon">
                              <i class="fa fa-cart-plus"></i>
                            </div>
                            <select name="po_No" placeholder="Purchase Order No." class="form-control  input-sm " formControlName="poId" (change)=" addPurchaseOrderItems($event.target.value)">
                              <option value="{{purchaseOrder.id}}" *ngFor="let purchaseOrder of purchaseOrders">{{ purchaseOrder.id}}({{purchaseOrder.purchase_order_date | date: 'MMMM, d, y'}})</option>
                            </select>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-2">
                        <div class="form-group">
                          <label>Supplier Bill No.
                            <span style="color: red;">*</span>
                          </label>
                          <div class="input-group">
                            <div class="input-group-addon">
                              <i class="fa fa-file-text-o"></i>
                            </div>
                            <input type="text" name="supplierBillNo" placeholder="Supplier Bill No." required="required" class="form-control  input-sm "
                              formControlName="supplier_bill_no">
                          </div>
                          <show-errors [control]="form.controls.supplier_bill_no"></show-errors>
                        </div>
                      </div>
                      <div class="col-md-3">
                        <div class="form-group">
                          <label>Supplier Bill Date
                            <span style="color: red;">*</span>
                          </label>
                          <my-date-picker name="supplier_bill_date" id="supplier_billdate" formControlName="supplier_bill_date" placeholder="Supplier Bill Date"
                            [options]="myDatePickerOptions" [(ngModel)]="model1" required></my-date-picker>
                          <show-errors [control]="form.controls.supplier_bill_date"></show-errors>
                        </div>

                      </div>
                    </div>
                    <div class="row" style="margin-bottom: 3px;">
                      <div class="col-md-8">
                        <button type="button" class="btn btn-primary" (click)="AddItems()">
                          <i class="fa fa-plus"></i> Add</button>
                      </div>
                      <div class="col-md-4">
                        <input type="text" placeholder="Search" class="form-control input-sm pull-right">
                      </div>
                    </div>
                    <div class="box box-default" style="border-top: 0px;">
                      <div class="box-body" style="margin: 1px; border: 2px solid rgb(200, 200, 200); border-radius: 5px;">
                        <div class="table-spinner" style="display: none;">
                          <i class="fa fa-spinner fa-pulse fa-spin  fa-4x fa-fw"></i>
                          <span class="sr-only">Loading...</span>
                        </div>
                        <div class="row">
                          <div class="col-md-12 table-responsive item-table">
                            <table class="table table-bordered table-striped">
                              <thead>
                                <tr>
                                  <th>Item code</th>
                                  <th>Item Name</th>
                                  <th>Category</th>
                                  <th>Quantity</th>
                                  <th>Unit</th>
                                  <th>Rate</th>
                                  <th>C.P. VAT(%)</th>
                                  <th>Amount</th>
                                  <th>Discount(%)</th>
                                  <th>Actions</th>
                                </tr>
                              </thead>
                              <tbody formArrayName="purchaseItems">
                                <tr *ngIf="purchaseList === null || purchaseList.length === 0 ">
                                  <td colspan="10" class="text-center">No Records</td>
                                </tr>
                                <tr [formGroupName]="i" *ngFor="let items of form.get('purchaseItems')['controls'];let i=index">
                                  <ng-template [ngIf]="items.value['deleted']==false">
                                    <td>{{ items.value['itemObj']['barcode'] || items.barcode }}</td>
                                    <td>{{ items.value['itemObj']['itemName'] || items.value['itemName'] }}</td>
                                    <td>{{ items.value['itemObj']['category']['categorie'] || items.value['categorie'] }}</td>
                                    <td>
                                      <input type="text" class="pitemsquantity input-sm form-control" formControlName="quantity" (change)="changeQtyRateCalculation()"
                                      />
                                    </td>
                                    <td>{{ items.value['itemObj']['unit']['unit'] || items.value['itemObj']['unit']}}</td>
                                    <td>
                                      <input type="text" class="pitemsrate input-sm form-control" formControlName="rate" (change)="changeQtyRateCalculation()"
                                      />
                                    </td>
                                    <td>
                                      <input type="text" class="pitemscpvat input-sm form-control" formControlName="cp_vat" (change)="changeQtyRateCalculation()"
                                      />
                                    </td>
                                    <td>{{ items.value['total_amount'] }}</td>
                                    <td>{{ items.value['itemObj']['discount_rate'] || items.value['discount_rate'] }}</td>
                                    <td style="width:8%;">
                                      <!--  <a class="btn btn-xs btn-info btn-circle" (click)="show =show" (click)="editItems(i)">
                                        <i aria-hidden="true" class="fa fa-pencil"></i>
                                      </a> -->
                                      <a (click)="deleteItems(i)" class="btn btn-xs btn-danger btn-circle ">
                                        <i aria-hidden="true" class="fa fa-trash"></i>
                                      </a>
                                    </td>
                                  </ng-template>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="well margin-top-space">
                      <div class="row">
                        <div class="col-md-5">
                          <div class="row">
                            <div class="col-md-6">
                              <div class="form-group">
                                <label>Purchase
                                  <span style="color: red;">*</span>
                                </label>
                                <select name="purchase" id="" required="required" class="form-control input-sm" formControlName="purchase_mode">
                                  <option value="">Please Select</option>
                                  <option value="1">Cash</option>
                                  <option value="2">Credit</option>
                                </select>
                              </div>
                              <show-errors [control]="form.controls.purchase_mode"></show-errors>
                            </div>
                            <div class="col-md-6">
                              <div class="form-group">
                                <label>Received by
                                  <span style="color: red;">*</span>
                                </label>
                                <select id="" required="" style="" tabindex="-1" class="form-control  input-sm" aria-hidden="true" formControlName="received_by">
                                  <option value="">Please Select</option>
                                  <option value="{{employee.id}}" *ngFor="let employee of employees">{{employee.name}}</option>
                                </select>
                              </div>
                              <show-errors [control]="form.controls.received_by"></show-errors>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-12" style="display: none;">
                              <div class="form-group">
                                <label for="title">Remark</label>
                                <label>
                                  <span style="color: red;">*</span>
                                </label>
                                <textarea name="remark" rows="4" placeholder="Remark" class="form-control input-sm fix-textarea"></textarea>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-7">
                          <div class="row margin-b-2px">
                            <div class="col-md-3 ">
                              <label class="pull-right">Sub Total</label>
                            </div>
                            <div class="col-md-9">
                              <input type="text" name="subTotal" readonly="readonly" class="form-control input-sm  billVal" formControlName="sub_total">
                            </div>
                          </div>
                          <div class="row margin-b-2px">
                            <div class="col-md-3 ">
                              <label class="pull-right">VAT Amount</label>
                            </div>
                            <div class="col-md-9">
                              <input type="text" name="vat_amount" readonly="readonly" class="form-control input-sm  billVal" formControlName="vat_amount">
                            </div>
                          </div>
                          <div class="row margin-b-2px">
                            <div class="col-md-3 ">
                              <label class="pull-right">Discount Amt</label>
                            </div>
                            <div class="col-md-9">
                              <div class="col-md-6 no-h-padding" style="padding-right: 5px;">
                                <input type="text" name="disAmount" readonly="readonly" class="form-control input-sm  billVal" formControlName="discount_amount">
                              </div>
                              <div class="col-md-6 no-h-padding">
                                <div class="col-md-5 no-h-padding">
                                  <label for="" style="padding-right: 5px;"> Extra Dis. </label>
                                </div>
                                <div class="col-md-7 no-h-padding">
                                  <input type="text" name="extraDiscount" class="form-control billVal input-sm extraDiscount validate-decimal" formControlName="extra_discount"
                                    (change)="getFinalBillAmount()">
                                </div>
                              </div>
                            </div>
                          </div>
                          <div class="row margin-b-2px">
                            <div class="col-md-3 ">
                              <label for="" class="pull-right">Bill Amount</label>
                            </div>
                            <div class="col-md-9">
                              <input type="text" name="billAmount" readonly="readonly" class="form-control input-sm  billVal" formControlName="bill_amount">
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-12">
                        <button disabled="disabled" class="btn btn-indigo">
                          <i aria-hidden="true" class="fa fa-print"></i> Print</button>
                        <button type="submit" class="btn btn-primary">
                          <i aria-hidden="true" class="fa fa-floppy-o"></i> {{formEditMode!=true ? 'Save' : 'Update'}}</button>
                        <a class="btn btn-danger" (click)="resetForm()">Cancel</a>
                        <a class="btn btn-cyan" (click)="reset()">
                          <i aria-hidden="true" class="fa fa-refresh"></i> Reset</a>
                        <a data-toggle="modal" (click)="openImportItemsDialog()" class="btn btn-indigo pull-right horizontal-margin">
                          <i aria-hidden="true" class="fa fa-upload"></i> Import Items</a>
                        <input type="file" #importItemsfileInput style="opacity:0" (change)="readExcelFile($event)" #input />
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
      <div class="row" style="margin-top: 15px;">
        <div class="col-md-12 table-responsive purchase-table purchase " *ngIf="!show" @slideIn>
          <div id="DataTables_Table_0_wrapper" class="dataTables_wrapper form-inline dt-bootstrap">
            <div class="row">
              <div class="col-sm-6">
                <div class="dataTables_length" id="DataTables_Table_0_length">
                  <label>Show
                    <select name="DataTables_Table_0_length" aria-controls="DataTables_Table_0" class="form-control input-sm">
                      <option value="10">10</option>
                      <option value="25">25</option>
                      <option value="50">50</option>
                      <option value="100">100</option>
                    </select> entries</label>
                </div>
              </div>
              <div class="col-sm-6">
                <div id="DataTables_Table_0_filter" class="dataTables_filter">
                  <label>Search:
                    <input type="search" #box (keyup.enter)="onEnter(box.value)" class="form-control input-sm" placeholder="" aria-controls="DataTables_Table_0">
                  </label>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-12">
                <table class="table table-bordered table-striped datatable1 dataTable" id="DataTables_Table_0" role="grid" aria-describedby="DataTables_Table_0_info">
                  <thead>
                    <tr role="row">
                      <th style="width: 5%;">
                        <a class="text-white" [routerLink]="[ '/stock/purchase_entrie']" [queryParams]="sortDir == 'desc' && sortCol =='id' ?{sort:'id', dir:'asc' }:{sort:'id', dir:'desc'} ">#</a>
                        <i class="{{ sortCol == 'id' && sortDir == 'desc' ? 'fa fa-sort-desc' : 'fa fa-sort-asc'}} pull-right" aria-hidden="true"></i>
                      </th>
                      <th class="sorting ">
                        <a class="text-white " [routerLink]="[ '/stock/purchase_entrie']" [queryParams]="sortDir == 'desc' && sortCol =='supplier_bill_no' ?{sort:'supplier_bill_no', dir:'asc' }:{sort:'supplier_bill_no', dir:'desc'} ">Supplier Bill No.</a>
                        <i class="{{ sortCol == 'supplier_bill_no' && sortDir == 'desc' ? 'fa fa-sort-desc' : 'fa fa-sort-asc'}} pull-right" aria-hidden="true"></i>
                      </th>
                      <th class="sorting ">
                        <a class="text-white " [routerLink]="[ '/stock/purchase_entrie']" [queryParams]="sortDir == 'desc' && sortCol =='supplier_bill_date' ?{sort:'supplier_bill_date', dir:'asc' }:{sort:'supplier_bill_date', dir:'desc'} ">Supplier Bill Date</a>
                        <i class="{{ sortCol == 'supplier_bill_date' && sortDir == 'desc' ? 'fa fa-sort-desc' : 'fa fa-sort-asc'}} pull-right" aria-hidden="true"></i>
                      </th>
                      <th class="sorting ">
                        <a class="text-white " [routerLink]="[ '/stock/purchase_entrie']" [queryParams]="sortDir == 'desc' && sortCol =='supplierId' ?{sort:'supplierId', dir:'asc' }:{sort:'supplierId', dir:'desc'} ">Supplier Name</a>
                        <i class="{{ sortCol == 'supplierId' && sortDir == 'desc' ? 'fa fa-sort-desc' : 'fa fa-sort-asc'}} pull-right" aria-hidden="true"></i>
                      </th>
                      <th class="sorting ">
                        <a class="text-white " [routerLink]="[ '/stock/purchase_entrie']" [queryParams]="sortDir == 'desc' && sortCol =='poId' ?{sort:'poId', dir:'asc' }:{sort:'poId', dir:'desc'} ">Purchase Order No.</a>
                        <i class="{{ sortCol == 'poId' && sortDir == 'desc' ? 'fa fa-sort-desc' : 'fa fa-sort-asc'}} pull-right" aria-hidden="true"></i>
                      </th>
                      <th class="sorting ">
                        <a class="text-white " [routerLink]="[ '/stock/purchase_entrie']" [queryParams]="sortDir == 'desc' && sortCol =='bill_amount' ?{sort:'bill_amount', dir:'asc' }:{sort:'bill_amount', dir:'desc'} ">Bill Amount</a>
                        <i class="{{ sortCol == 'bill_amount' && sortDir == 'desc' ? 'fa fa-sort-desc' : 'fa fa-sort-asc'}} pull-right" aria-hidden="true"></i>
                      </th>
                      <th style="width: 12%;">Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr role="row" class="odd" *ngFor="let purchase of purchases |paginate: { itemsPerPage: purchasesPerPage, currentPage: pageIndex , totalItems: totalPurchases};let
                    i=index; ">
                      <td class="sorting_1">{{ purchase.id }}</td>
                      <td>{{purchase.supplier_bill_no}}</td>
                      <td>{{ purchase.supplier_bill_date }}</td>
                      <td>{{ purchase.supplier.company_name }}</td>
                      <td>{{ purchase.poId}}</td>
                      <td>{{ purchase.bill_amount }}</td>
                      <td>
                        <a class="btn btn-xs btn-info btn-circle" (click)="getEditPurchaseEntry(purchase.id)">
                          <i aria-hidden="true" class="fa fa-pencil"></i>
                        </a>
                        <a class="btn btn-xs btn-danger btn-circle " (click)="deletePurchase(purchase.id)">
                          <i aria-hidden="true" class="fa fa-trash"></i>
                        </a>
                      </td>
                    </tr>
                  </tbody>
                  <!--  <tfoot class="showSearch">
                    <tr>
                      <th rowspan="1" colspan="1">#</th>
                      <th class="search" rowspan="1" colspan="1">
                        <input type="text" class="form-control input-sm" placeholder=" Supplier Bill No.">
                      </th>
                      <th class="search" rowspan="1" colspan="1">
                        <input type="text" class="form-control input-sm" placeholder=" Supplier Bill Date">
                      </th>
                      <th class="search" rowspan="1" colspan="1">
                        <input type="text" class="form-control input-sm" placeholder=" Supplier">
                      </th>
                      <th class="search" rowspan="1" colspan="1">
                        <input type="text" class="form-control input-sm" placeholder=" Purchase Order No.">
                      </th>
                      <th class="search" rowspan="1" colspan="1">
                        <input type="text" class="form-control input-sm" placeholder=" Bill Amt">
                      </th>
                      <th style="width: 12%;" rowspan="1" colspan="1">Actions</th>
                    </tr>
                  </tfoot> -->
                </table>
                <div class="pull-right ">
                  <pagination-controls (pageChange)="getPage($event) "></pagination-controls>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>

  </section>

</div>